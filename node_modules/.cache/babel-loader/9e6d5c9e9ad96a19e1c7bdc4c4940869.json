{"ast":null,"code":"import _createForOfIteratorHelper from\"D:/ReactProjects/grocery-site/client/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper.js\";import _slicedToArray from\"D:/ReactProjects/grocery-site/client/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import styles from'./adminUpdate.module.css';import{Link,useNavigate}from\"react-router-dom\";import{useEffect,useState}from\"react\";import Error from\"../../../../../components/feedback/error/Error\";import Loading from\"../../../../../components/loading/Loading\";import{useDispatch}from\"react-redux\";import{adminUpdateDatabase}from\"../../../../../actions/products\";import Warning from\"../../../../../components/feedback/warning/Warning\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var AdminUpdate=function AdminUpdate(){var _useState=useState(null),_useState2=_slicedToArray(_useState,2),file=_useState2[0],setFile=_useState2[1];var _useState3=useState(\"\"),_useState4=_slicedToArray(_useState3,2),data=_useState4[0],setData=_useState4[1];var _useState5=useState(\"\"),_useState6=_slicedToArray(_useState5,2),mode=_useState6[0],setMode=_useState6[1];var _useState7=useState(\"\"),_useState8=_slicedToArray(_useState7,2),error=_useState8[0],setError=_useState8[1];var _useState9=useState(\"\"),_useState10=_slicedToArray(_useState9,2),warning=_useState10[0],setWarning=_useState10[1];var _useState11=useState(false),_useState12=_slicedToArray(_useState11,2),loading=_useState12[0],setLoading=_useState12[1];var dispatch=useDispatch();var navigate=useNavigate();useEffect(function(){setData(\"\");var reader=new FileReader();if(file!=null){reader.onload=function(){var lines=reader.result;setData(lines);};reader.readAsText(file);}},[file]);var handleSubmit=function handleSubmit(){// check if the file was uploaded\nif(!data||!file)return setError(\"Please upload a CSV file\");// check if there's a modification mode selected\nif(!mode)return setError(\"Please select a mode\");// check that all fields are included in the header\nvar fields=['product_id','name','price','image','weight','measurement','category','stock'];var headers=data.split(\"\\n\")[0].split(\",\");for(var _i=0,_fields=fields;_i<_fields.length;_i++){var field=_fields[_i];var found=false;var _iterator=_createForOfIteratorHelper(headers),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var header=_step.value;var headerCleaned=header.toLowerCase().replace(/(\\r)+/,\"\");if(headerCleaned===field.toLowerCase()){found=true;break;}}}catch(err){_iterator.e(err);}finally{_iterator.f();}if(!found)return setError(\"Field \".concat(field,\" was not found in the CSV header\"));}var onSuccess=function onSuccess(updatedData){setLoading(false);if(!updatedData.length)return setWarning('No changes; database matches the csv file');navigate('/admin/products/update/success');};var onError=function onError(e){setError(e.message);setLoading(false);};setLoading(true);dispatch(adminUpdateDatabase(data,mode,onSuccess,onError));};return/*#__PURE__*/_jsxs(\"div\",{className:styles['wrapper'],children:[loading&&/*#__PURE__*/_jsx(Loading,{text:'Updating Database',overlay:true}),error&&/*#__PURE__*/_jsx(Error,{error:error,setError:setError}),warning&&/*#__PURE__*/_jsx(Warning,{warning:warning,setWarning:setWarning}),/*#__PURE__*/_jsxs(\"div\",{className:styles['header'],children:[/*#__PURE__*/_jsx(\"div\",{className:'heading',children:/*#__PURE__*/_jsx(\"h1\",{children:\"Update Products\"})}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"span\",{className:styles['note'],children:\"Warning:\"}),\" Once the database is updated it cannot be restored.\"]})]}),/*#__PURE__*/_jsxs(\"div\",{className:styles['action'],children:[/*#__PURE__*/_jsx(\"input\",{onChange:function onChange(e){return setFile(e.target.files[0]);},type:'file',accept:'text/csv'}),/*#__PURE__*/_jsxs(\"div\",{className:styles['mode'],children:[/*#__PURE__*/_jsx(\"div\",{className:styles['mode-title'],children:\"Mode\"}),/*#__PURE__*/_jsx(\"div\",{onClick:function onClick(){return setMode(\"UPDATE\");},className:\"\".concat(styles[\"mode-btn\"],\" \").concat(mode===\"UPDATE\"&&styles['active']),children:\"Update products by id\"}),/*#__PURE__*/_jsx(\"div\",{onClick:function onClick(){return setMode(\"REGENERATE\");},className:\"\".concat(styles[\"mode-btn\"],\" \").concat(mode===\"REGENERATE\"&&styles['active']),children:\"Delete all entries and upload csv\"})]}),/*#__PURE__*/_jsx(\"div\",{onClick:handleSubmit,className:\"btn1 \".concat(styles['update']),children:\"Update\"}),/*#__PURE__*/_jsx(Link,{className:styles['format'],to:'/admin/products/update/help',children:\"CSV Format Guidelines\"})]})]});};export default AdminUpdate;","map":{"version":3,"names":["styles","Link","useNavigate","useEffect","useState","Error","Loading","useDispatch","adminUpdateDatabase","Warning","AdminUpdate","file","setFile","data","setData","mode","setMode","error","setError","warning","setWarning","loading","setLoading","dispatch","navigate","reader","FileReader","onload","lines","result","readAsText","handleSubmit","fields","headers","split","field","found","header","headerCleaned","toLowerCase","replace","onSuccess","updatedData","length","onError","e","message","target","files"],"sources":["D:/ReactProjects/grocery-site/client/src/pages/admin/products/update/default/AdminUpdate.js"],"sourcesContent":["import styles from './adminUpdate.module.css';\nimport {Link, useNavigate} from \"react-router-dom\";\nimport {useEffect, useState} from \"react\";\nimport Error from \"../../../../../components/feedback/error/Error\";\nimport Loading from \"../../../../../components/loading/Loading\";\nimport {useDispatch} from \"react-redux\";\nimport {adminUpdateDatabase} from \"../../../../../actions/products\";\nimport Warning from \"../../../../../components/feedback/warning/Warning\";\n\nconst AdminUpdate = () => {\n\n    const [file, setFile] = useState(null);\n    const [data, setData] = useState(\"\");\n    const [mode, setMode] = useState(\"\");\n    const [error, setError] = useState(\"\");\n    const [warning, setWarning] = useState(\"\");\n    const [loading, setLoading] = useState(false);\n    const dispatch = useDispatch();\n    const navigate = useNavigate();\n\n    useEffect(() => {\n        setData(\"\");\n        const reader = new FileReader()\n        if (file != null) {\n            reader.onload = () => {\n                const lines = reader.result;\n                setData(lines);\n            };\n            reader.readAsText(file);\n        }\n    }, [file])\n\n    const handleSubmit = () => {\n\n        // check if the file was uploaded\n        if (!data || !file)\n            return setError(\"Please upload a CSV file\");\n\n        // check if there's a modification mode selected\n        if (!mode)\n            return setError(\"Please select a mode\");\n\n        // check that all fields are included in the header\n        const fields = ['product_id', 'name', 'price', 'image', 'weight', 'measurement', 'category', 'stock'];\n        const headers = data.split(\"\\n\")[0].split(\",\");\n        for (const field of fields) {\n            let found = false;\n            for (const header of headers) {\n                const headerCleaned = header.toLowerCase().replace(/(\\r)+/, \"\");\n                if (headerCleaned === field.toLowerCase()) {\n                    found = true;\n                    break;\n                }\n            }\n\n            if (!found)\n                return setError(`Field ${field} was not found in the CSV header`);\n        }\n\n        const onSuccess = (updatedData) => {\n            setLoading(false);\n            if (!updatedData.length)\n                return setWarning('No changes; database matches the csv file');\n            navigate('/admin/products/update/success');\n        }\n\n        const onError = (e) => {\n            setError(e.message);\n            setLoading(false);\n        }\n\n        setLoading(true);\n        dispatch(adminUpdateDatabase(data, mode, onSuccess, onError));\n    }\n\n    return (\n        <div className={styles['wrapper']}>\n            {loading && <Loading text={'Updating Database'} overlay={true}/>}\n            {error && <Error error={error} setError={setError}/>}\n            {warning && <Warning warning={warning} setWarning={setWarning}/>}\n            <div className={styles['header']}>\n                <div className={'heading'}>\n                    <h1>Update Products</h1>\n                </div>\n                <p><span className={styles['note']}>Warning:</span> Once the database is updated it cannot be restored.\n                </p>\n            </div>\n            <div className={styles['action']}>\n                <input onChange={(e) => setFile(e.target.files[0])} type={'file'} accept={'text/csv'}/>\n                <div className={styles['mode']}>\n                    <div className={styles['mode-title']}>Mode</div>\n                    <div onClick={() => setMode(\"UPDATE\")}\n                         className={`${styles[`mode-btn`]} ${mode === \"UPDATE\" && styles['active']}`}>Update products by\n                        id\n                    </div>\n                    <div onClick={() => setMode(\"REGENERATE\")}\n                         className={`${styles[`mode-btn`]} ${mode === \"REGENERATE\" && styles['active']}`}>Delete all\n                        entries and\n                        upload csv\n                    </div>\n                </div>\n                <div onClick={handleSubmit} className={`btn1 ${styles['update']}`}>Update</div>\n                <Link className={styles['format']} to={'/admin/products/update/help'}>CSV Format Guidelines</Link>\n            </div>\n        </div>\n    );\n}\n\nexport default AdminUpdate;"],"mappings":"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"},"metadata":{},"sourceType":"module"}